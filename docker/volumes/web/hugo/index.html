<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Crack it</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/cover/">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="css/mdb.min.css">

    <!-- Custom styles for this template -->
    <link href="css/cover.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body class="text-center">

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">

        <header class="masthead mb-auto">
            <div class="inner">
                <h3 class="masthead-brand">Crackit</h3>
                <nav class="nav nav-masthead justify-content-center">
                    <a class="nav-link active" href="#">Home</a>
                    <a class="nav-link" href="#">Connection</a>
                </nav>
            </div>
        </header>

        <!-- Form mdp-->
        <main role="main" class="inner cover" id="mdp">

            <!-- Formulaire -->
            <div class="card bg-dark p-3">
                <h3>Test your password here</h3>
                <form onsubmit="checkPassword(password)" method="post">
                    <div class="form-group">
                        <input type="password" class="form-control">
                        <small class="form-text text-muted">We'll never use you password against you</small>
                    </div>
                </form>
                <button onclick="change()" class="btn btn-warning">Check</button>
            </div>

        </main>

        <!-- Statistiques -->
        <main role="main" class="inner cover" id="stats" hidden>

            <div class="row">
                <div class="col">                
                    <div class="alert alert-danger mx-auto" role="alert">Attention ! Mot de passe trop faible !</div>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col">
                    <div class="card bg-dark">
                        <h4>Top passwords</h4>

                        <table class="table table-striped table-dark">
                            <thead>
                              <tr>
                                <th scope="col">#</th>
                                <th scope="col">Text</th>
                                <th scope="col">Seen</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <th scope="row">1</th>
                                <td id="top1"></td>
                                <td id="top1_nb"></td>
                              </tr>
                              <tr>
                                <th scope="row">2</th>
                                <td id="top2"></td>
                                <td id="top2_nb"></td>
                              </tr>
                              <tr>
                                <th scope="row">3</th>
                                <td id="top3"></td>
                                <td id="top3_nb"></td>
                              </tr>
                            </tbody>
                        </table>

                    </div>
                </div>

                <div class="col">

                    <div class="card bg-dark">
                        <h4>Total dictionnary</h4>
                        <p id="total"></p>
                    </div>

                    <div class="card bg-dark mt-3">
                        <h4>Total hashes</h4>
                        <p id="hash"></p>
                    </div>

                </div>

            </div>

            <div class="row mt-3">
                <div class="col">
                    <div class="card bg-dark p-3">
                        <h3>Found during the last 7 days</h3>
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
           

        </main>

        <footer class="mastfoot mt-auto">
            <div class="inner">
                <p>Cover template for <a href="https://getbootstrap.com/">Bootstrap</a>, by <a
                        href="https://twitter.com/mdo">@mdo</a>.</p>
            </div>
        </footer>
    </div>

</body>

<!-- jQuery -->
<script type="text/javascript" src="js/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="js/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="js/mdb.min.js"></script>

<!-- Ajax -->
<script>
    //Top passwords
    $.ajax({dataType: "json", url: "/api/password/stats/top10", success: function(result){ 
        $("#top1").html(result[0][1]);
        $("#top1_nb").html(result[0][2]);

        $("#top2").html(result[1][1]);
        $("#top2_nb").html(result[0][2]);

        $("#top3").html(result[2][1]);
        $("#top3_nb").html(result[0][2]);

    }});

    //Total passwords
    $.ajax({url: "/api/password/stats/count", success: function(result){ 
        $("#total").html(result);
    }});

    //Total hashes
    $.ajax({url: "/api/hash/stats/count", success: function(result){ 
        $("#hash").html(result);
    }});

    //===============================================

    function change() {
        var mdp = document.getElementById("mdp");
        var stats = document.getElementById("stats");
        stats.className = stats.toggleAttribute("hidden");
        mdp.className = mdp.toggleAttribute("hidden");
    }

    function checkPassword(password) {
        $.post("/api/password/check", {"password":password}), function(result) { 
            $("#hash").html(result);
        };

        change() ;

    }
</script>

<!-- Graph -->
<script>

    //Seven days
    $.ajax({url: "/api/password/stats/lastweek", success: function(result){ 
        console.log(result);
        one = result[0][0];
        if (typeof result[1] !== 'undefined') {two = result[1][0];};
        if (typeof result[1] !== 'undefined') {three = result[2][0];};
        if (typeof result[1] !== 'undefined') {four = result[3][0];};
        if (typeof result[1] !== 'undefined') {five = result[4][0];};
        if (typeof result[1] !== 'undefined') {six = result[5][0];};
        if (typeof result[1] !== 'undefined') {seven = result[6][0];};

        //line
        var ctxL = document.getElementById("lineChart").getContext('2d');
        var myLineChart = new Chart(ctxL, {
            type: 'line',
            data: {
            labels: ["6 days", "5 days", "4 days", "3 days", "2 days", "Yesterday", "Today"],
            datasets: [{
                label: "Found",
                data: [seven, six, five, four, three, two, one],
                backgroundColor: [
                    'rgba(251,198,69, .2)',
                ],
                borderColor: [
                    'rgba(251,198,69)',
                ],
                borderWidth: 2
            }]
            },
            options: {
                responsive: true
            }
        });

    }});

</script>

</html>